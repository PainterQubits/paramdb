# Parameter Data

```{py:currentmodule} paramdb

```

<!-- Jupyter Sphinx setup -->

```{jupyter-execute}
:hide-code:

from __future__ import annotations
```

## Parameters

A parameter is defined from the base class {py:class}`Param`. This custom class is
intended to be defined using the [`@dataclass`] decorator, meaning that class variables
with type annotations are automatically become object properties, and the corresponding
[`__init__`] function is generated. An example of a defining a custom parameter is shown
below.

```{jupyter-execute}
from dataclasses import dataclass
from paramdb import Param

@dataclass
class CustomParam(Param):
    value: float

param = CustomParam(value=1.23)
```

These properties can then be accessed and updated.

```{jupyter-execute}
param.value += 0.004
param.value
```

````{tip}
Methods can also be added to {py:class}`Param` and {py:class}`Struct` subclasses,
including read-only properties using the
[`@property`](https://docs.python.org/3/library/functions.html#property) decorator. For
example:

```{jupyter-execute}
@dataclass
class ParamWithProperty(Param):
    value: int

    @property
    def value_cubed(self) -> int:
        return self.value ** 3

param_with_property = ParamWithProperty(value=16)
param_with_property.value_cubed
```
````

````{warning}
Since [`__init__`] is generated by the [`@dataclass`] decorator, other initialization must
be done using the [`__post_init__`] function. Furthermore, since [`__post_init__`] is used
internally by {py:class}`ParamData`, {py:class}`Param`, and {py:class}`Struct` to perform
initialization, always call the superclass's [`__post_init__`] at the end. For example,

```{jupyter-execute}
@dataclass
class ParamCustomInit(Param):
    def __post_init__(self) -> None:
        print("Initializing...")  # Replace with custom initialization code
        super().__post_init__()

param_custom_init = ParamCustomInit()
```
````

Parameters track when any of their properties was last updated in the read-only
{py:attr}`Param.last_updated` property. For example:

```{jupyter-execute}
param.last_updated
```

```{jupyter-execute}
import time

time.sleep(1)
param.value += 1
param.last_updated
```

## Structures

A structure is defined from the base class {py:class}`Struct` and is intended
to be defined as a dataclass. A structure can contain any data, but it is intended to
store parameters and lists and dictionaries of parameters. For example:

```{jupyter-execute}
from paramdb import Struct

@dataclass
class CustomStruct(Struct):
    param: CustomParam
    param_dict: dict[str, CustomParam]

struct = CustomStruct(
    param = param,
    param_dict = {
        "p1": CustomParam(value=4.56),
        "p2": CustomParam(value=7.89),
    }
)
```

Structures also have a {py:attr}`Struct.last_updated` property that computes the most
recent last updated time from any of its child parameters (including those within
structures, lists, and dictionaries). For example:

```{jupyter-execute}
struct.last_updated
```

```{jupyter-execute}
time.sleep(1)
struct.param_dict["p2"].value += 1
struct.last_updated
```

<!-- ## Parent and Root Mixins

A parameter data class can access its parent using {py:class}`ParentMixin`, which adds the
property {py:attr}`~ParentMixin.parent`. For example,

```{jupyter-execute}
from paramdb import ParentMixin

@dataclass
class ParentStruct(Struct):
    param: ParamWithParent

@dataclass
class ParamWithParent(ParentMixin[CustomStruct], Param):
    value: float

parent_struct = ParentStruct(
    param=ParamWithParent(value=1.23),
)
parent_struct.param.parent is parent_struct
```

```{warning}
Type checkers will assume that the type of {py:attr}`~ParentMixin.parent` or
{py:attr}`~RootMixin.root` is the type parameter passed to the corresponding mixin, even
if it is not. This feature is included for convenience, but be careful not to use a
parent of the wrong type.
```

Similarly, {py:class}`RootMixin` allows the root of the structure to be accessed via the
property {py:attr}`~RootMixin.root`. For example,

```{jupyter-execute}
from paramdb import RootMixin

@dataclass
class RootStruct(Struct):
    struct: ParentStruct

@dataclass
class ParentStruct(Struct):
    param: ParamWithRoot

@dataclass
class ParamWithRoot(RootMixin[RootStruct], Param):
    value: float

root_struct = RootStruct(
    struct=ParentStruct(
        param=ParamWithRoot(value=1.23),
    ),
)
root_struct.struct.param.root is root_struct
``` -->

[`@dataclass`]: https://docs.python.org/3/library/dataclasses.html#dataclasses.dataclass
[`__init__`]: https://docs.python.org/3/reference/datamodel.html#object.__init__
[`@property`]: https://docs.python.org/3/library/functions.html#property
[`__post_init__`]: https://docs.python.org/3/library/dataclasses.html#post-init-processing
